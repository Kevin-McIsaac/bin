#!/bin/bash
# Set up the workbench server
#

# Attached and mount the home volume over /home
aws ec2 attach-volume --volume-id $1  --device /dev/sdf --instance-id `ec2-metadata -i | cut -d' '  -f 2`  

until ( lsblk | grep -q xvdf1 ) ; do   
   sleep 2; echo waiting on device /dev/sdf
 done

sudo mount /dev/xvdf1 /home

# Setup and run jupyter notebook server
cd ~ec2-user/bin
sudo cp jupyter.init.d /etc/init.d/jupyter
sudo service jupyter start

# Upate DNS to point workbench URL to this server
./update-route53-dns

sudo yum update -y
sudo yum install git iotop -y
